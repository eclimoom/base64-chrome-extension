import { AfterViewInit, Component } from '@angular/core';

const STORAGE_BASE_NAME = 'storageBase64';
const INIT_BASE64_STRING =
  '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IEAgL2AA5CsSkAABAgQI7AUMgL2piwQIECBAIC9gAOQrEpAAAQIECOwFDIC9qYsECBAgQCAvYADkKxKQAAECBAjsBQyAvamLBAgQIEAgL2AA5CsSkAABAgQI7AUMgL2piwQIECBAIC9gAOQrEpAAAQIECOwFDIC9qYsECBAgQCAvYADkKxKQAAECBAjsBQyAvamLBAgQIEAgL2AA5CsSkAABAgQI7AUMgL2piwQIECBAIC9gAOQrEpAAAQIECOwFDIC9qYsECBAgQCAvYADkKxKQAAECBAjsBQyAvamLBAgQIEAgL2AA5CsSkAABAgQI7AUMgL2piwQIECBAIC9gAOQrEpAAAQIECOwFDIC9qYsECBAgQCAvYADkKxKQAAECBAjsBQyAvamLBAgQIEAgL2AA5CsSkAABAgQI7AUMgL2piwQIECBAIC9gAOQrEpAAAQIECOwFDIC9qYsECBAgQCAvYADkKxKQAAECBAjsBQyAvamLBAgQIEAgL2AA5CsSkAABAgQI7AUMgL2piwQIECBAIC9gAOQrEpAAAQIECOwFDIC9qYsECBAgQCAvYADkKxKQAAECBAjsBQyAvamLBAgQIEAgL2AA5CsSkAABAgQI7AUMgL2piwQIECBAIC9gAOQrEpAAAQIECOwFDIC9qYsECBAgQCAvYADkKxKQAAECBAjsBQyAvamLBAgQIEAgL2AA5CsSkAABAgQI7AUMgL2piwQIECBAIC9gAOQrEpAAAQIECOwFDIC9qYsECBAgQCAvYADkKxKQAAECBAjsBQyAvamLBAgQIEAgL2AA5CsSkAABAgQI7AUMgL2piwQIECBAIC9gAOQrEpAAAQIECOwFDIC9qYsECBAgQCAvYADkKxKQAAECBAjsBQyAvamLBAgQIEAgL2AA5CsSkAABAgQI7AUMgL2piwQIECBAIC9gAOQrEpAAAQIECOwFDIC9qYsECBAgQCAvYADkKxKQAAECBAjsBQyAvamLBAgQIEAgL2AA5CsSkAABAgQI7AUMgL2piwQIECBAIC9gAOQrEpAAAQIECOwFDIC9qYsECBAgQCAvYADkKxKQAAECBAjsBQyAvamLBAgQIEAgL2AA5CsSkAABAgQI7AUMgL2piwQIECBAIC9gAOQrEpAAAQIECOwFDIC9qYsECBAgQCAvYADkKxKQAAECBAjsBQyAvamLBAgQ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dyQhAQIECBCYCxgAc1IHCRAgQIBAX8AA6HckIQECBAgQmAsYAHNSBwkQIECAQF/AAOh3JCEBAgQIEJgLGABzUgcJECBAgEBfwADodyQhAQIECBCYCxgAc1IHCRAgQIBAX8AA6HckIQECBAgQmAsYAHNSBwkQIECAQF/AAOh3JCEBAgQIEJgLGABzUgcJECBAgEBfwADodyQhAQIECBCYCxgAc1IHCRAgQIBAX8AA6HckIQECBAgQmAsYAHNSBwkQIECAQF/AAOh3JCEBAgQIEJgLGABzUgcJECBAgEBfwADodyQhAQIECBCYCxgAc1IHCRAgQIBAX8AA6HckIQECBAgQmAsYAHNSBwkQIECAQF/AAOh3JCEBAgQIEJgLGABzUgcJECBAgEBfwADodyQhAQIECBCYCxgAc1IHCRAgQIBAX8AA6HckIQECBAgQmAsYAHNSBwkQIECAQF/AAOh3JCEBAgQIEJgLGABzUgcJECBAgEBfwADodyQhAQIECBCYCxgAc1IHCRAgQIBAX8AA6HckIQECBAgQmAsYAHNSBwkQIECAQF/AAOh3JCEBAgQIEJgLGABzUgcJECBAgEBfwADodyQhAQIECBCYCxgAc1IHCRAgQIBAX8AA6HckIQECBAgQmAsYAHNSBwkQIECAQF/AAOh3JCEBAgQIEJgLGABzUgcJECBAgEBfwADodyQhAQIECBCYCxgAc1IHCRAgQIBAX8AA6HckIQECBAgQmAsYAHNSBwkQIECAQF/AAOh3JCEBAgQIEJgLGABzUgcJECBAgEBfwADodyQhAQIECBCYCxgAc1IHCRAgQIBAX8AA6HckIQECBAgQmAsYAHNSBwkQIECAQF/AAOh3JCEBAgQIEJgLGABzUgcJECBAgEBfwADodyQhAQIECBCYCxgAc1IHCRAgQIBAX8AA6HckIQECBAgQmAsYAHNSBwkQIECAQF/AAOh3JCEBAgQIEJgLGABzUgcJECBAgEBfwADodyQhAQIECBCYCxgAc1IHCRAgQIBAX8AA6HckIQECBAgQmAsYAHNSBwkQIECAQF/AAOh3JCEBAgQIEJgLGABzUgcJECBAgEBfwADodyQhAQIECBCYCxgAc1IHCRAgQIBAX8AA6HckIQECBAgQmAsYAHNSBwkQIECAQF/AAOh3JCEBAgQIEJgLGABzUgcJECBAgEBfwADodyQhAQIECBCYCxgAc1IHCRAgQIBAX8AA6HckIQECBAgQmAsYAHNSBwkQIECAQF/AAOh3JCEBAgQIEJgLGABzUgcJECBAgEBfwADodyQhAQIECBCYCxgAc1IHCRAgQIBAX8AA6HckIQECBAgQmAsYAHNSBwkQIECAQF/AAOh3JCEBAgQIEJgLGABzUgcJECBAgEBfwADodyQhAQIECBCYCxgAc1IHCRAgQIBAX8AA6HckIQECBAgQmAsYAHNSBwkQIECAQF/AAOh3JCEBAgQIEJgLGABzUgcJECBAgEBfwADodyQhAQIECBCYCxgAc1IHCRAgQIBAX8AA6HckIQECBAgQmAsYAHNSBwkQIECAQF/AAOh3JCEBAgQIEJgLGABzUgcJECBAgEBfwADodyQhAQIECBCYCxgAc1IHCRAgQIBAX8AA6HckIQECBAgQmAsYAHNSBwkQIECAQF/AAOh3JCEBAgQIEJgLGABzUgcJECBAgEBfwADodyQhAQIECBCYCxgAc1IHCRAgQIBAX8AA6HckIQECBAgQmAsYAHNSBwkQIECAQF/AAOh3JCEBAgQIEJgLGABzUgcJECBAgEBfwADodyQhAQIECBCYCxgAc1IHCRAgQIBAX8AA6HckIQECBAgQmAsYAHNSBwkQIECAQF/AAOh3JCEBAgQIEJgLGABzUgcJECBAgEBfwADodyQhAQIECBCYCxgAc1IHCRAgQIBAX8AA6HckIQECBAgQmAsYAHNSBwkQIECAQF/AAOh3JCEBAgQIEJgLGABzUgcJECBAgEBfwADodyQhAQIECBCYCxgAc1IHCRAgQIBAX8AA6HckIQECBAgQmAsYAHNSBwkQIECAQF/AAOh3JCEBAgQIEJgLGABzUgcJECBAgEBfwADodyQhAQIECBCYCxgAc1IHCRAgQIBAX8AA6HckIQECBAgQmAsYAHNSBwkQIECAQF/AAOh3JCEBAgQIEJgLGABzUgcJECBAgEBfwADodyQhAQIECBCYCxgAc1IHCRAgQIBAX8AA6HckIQECBAgQmAsYAHNSBwkQIECAQF/AAOh3JCEBAgQIEJgLGABzUgcJECBAgEBfwADodyQhAQIECBCYCxgAc1IHCRAgQIBAX8AA6HckIQECBAgQmAsYAHNSBwkQIECAQF/AAOh3JCEBAgQIEJgLGABzUgcJECBAgEBfwADodyQhAQIECBCYCxgAc1IHCRAgQIBAX8AA6HckIQECBAgQmAsYAHNSBwkQIECAQF/AAOh3JCEBAgQIEJgLGABzUgcJECBAgEBfwADodyQhAQIECBCYCxgAc1IHCRAgQIBAX8AA6HckIQECBAgQmAsYAHNSBwkQIECAQF/gf5Kg/hA5sF1TAAAAAElFTkSuQmCC';

@Component({
  selector: 'app-root',
  templateUrl: './app.component.html',
  styleUrls: ['./app.component.scss'],
})
export class AppComponent implements AfterViewInit {
  title = 'base64-chrome-extension';
  baseString: string;
  list: any[];

  constructor() {
    this.list = this.getBase64List();
    this.baseString =
      this.list[0] && this.list[0].base64
        ? this.list[0].base64
        : INIT_BASE64_STRING;
  }

  ngAfterViewInit(): void {
    this.setSelectionRange()
  }

  decode(): string {
    const data = this.baseString.replace(/^\"|\"$|^\'|\'$/g, '').trim();
    return `data:image/png;base64,${data}`;
  }

  setSelectionRange() {
    let input = document.querySelector("textarea");
    if (input.setSelectionRange) {
      navigator.clipboard.readText()
        .then(text => {
          if(text){
            this.baseString = text;
          }
        })
        .catch(err => {
          console.error('Failed to read clipboard contents: ', err);
        });
      input.setSelectionRange(0, this.baseString.length);
    }
  }

  onImageLoad() {
    // 将解析成功的图片添加到历史
    this.setBase64List(this.baseString);
  }
  onImageError($event: Event) {
    console.log('onImageError', $event);
  }

  getBase64List() {
    return JSON.parse(localStorage.getItem(STORAGE_BASE_NAME) || '[]');
  }

  setBase64List(base64) {
    let list = this.getBase64List();
    if (list.find((item) => item.base64 === base64)) {
      return;
    }
    list.unshift({ base64, date: new Date() });
    list.length > 5 && (list.length = 5);
    localStorage.setItem(STORAGE_BASE_NAME, JSON.stringify(list));
  }
}
